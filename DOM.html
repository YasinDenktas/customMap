<!DOCTYPE html><!--  This site was created in Webflow. http://www.webflow.com  -->
<!--  Last Published: Thu Nov 05 2020 16:02:28 GMT+0000 (Coordinated Universal Time)  -->
<html data-wf-page="5f7dc0120f28a87dd12a1a09" data-wf-site="5f7dc0120f28a8f9662a1a08" lang="fr">
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
  <title>Google Maps Multiple Markers</title>
  <script src="https://maps.googleapis.com/maps/api/js?key=YOURAPIKEY&callback=initMap" defer type="text/javascript"></script>
</head>
<body class="body">
  <div class="maps-container">
    <div class="cr-ches-cms-home-hidden w-dyn-list">
      <div role="list" class="cr-ches-home-hidden w-dyn-items" hidden>
        <div id="w-node-99b7c6aa1b0e-d12a1a09" role="listitem" class="cr-che-ouverte w-dyn-item"><a href="/creches/les-anges-de-neudorf" class="cr-che-ouverte-link-block w-inline-block">
            <div class="cr-che-ouverte-div">
              <div style="background-image:url(&quot;https://assets.website-files.com/5f7dc2c927c1329399d2b3c9/5f8fe43a13e930b537e0f970_kid-pattern.jpg&quot;)" class="cr-che-ouverte-cover"></div>
              <div class="cr-che-ouverte-text">
                <h3 class="h3-cr-che">Les anges de Neudorf</h3>
                <p class="text-block-color">62 Route de l&#x27;hôpital, Neudorf</p>
                <div class="places-disponibles-cr-ches">
                  <p class="cr-che-place-dispo">10</p>
                  <p class="cr-che-place-dispo">Place(s) disponible(s)</p>
                </div>
                <p class="date w-dyn-bind-empty"></p>
                <p class="gmaplink">https://www.google.com/maps/place/62+Route+de+l&#x27;H%C3%B4pital,+67100+Strasbourg/@48.5690597,7.7489433,17z/data=!3m1!4b1!4m5!3m4!1s0x4796c9a8a02e7fa7:0x3674051fc5572aee!8m2!3d48.5690562!4d7.751132</p>
                <p class="p-cr-che">Ouverture prévue fin 2020. Vous pouvez déjà vous inscrire !</p>
              </div>
            </div>
          </a></div>
        <div id="w-node-99b7c6aa1b0e-d12a1a09" role="listitem" class="cr-che-ouverte w-dyn-item"><a href="/creches/les-anges-de-hoerdt" class="cr-che-ouverte-link-block w-inline-block">
            <div class="cr-che-ouverte-div">
              <div style="background-image:url(&quot;https://assets.website-files.com/5f7dc2c927c1329399d2b3c9/5f882168ca40dd4de8ccc936_Cre%CC%80ches-des-Anges-66-compressed.jpg&quot;)" class="cr-che-ouverte-cover"></div>
              <div class="cr-che-ouverte-text">
                <h3 class="h3-cr-che">Les anges de Hoerdt</h3>
                <p class="text-block-color">23 Rue du Manège, Hoerdt</p>
                <div class="places-disponibles-cr-ches">
                  <p class="cr-che-place-dispo">10</p>
                  <p class="cr-che-place-dispo">Place(s) disponible(s)</p>
                </div>
                <p class="date w-dyn-bind-empty"></p>
                <p class="gmaplink">https://www.google.com/maps/place/23+Rue+du+Man%C3%A8ge,+67720+H%C5%93rdt/@48.6891723,7.7804865,17z/data=!3m1!4b1!4m5!3m4!1s0x4796c72f35e13dd1:0x1ba90267ee4c260e!8m2!3d48.6891688!4d7.7826752</p>
                <p class="p-cr-che">Ouverture prévue fin 2020. Vous pouvez déjà vous inscrire !</p>
              </div>
            </div>
          </a></div>
        <div id="w-node-99b7c6aa1b0e-d12a1a09" role="listitem" class="cr-che-ouverte w-dyn-item"><a href="/creches/illkirch" class="cr-che-ouverte-link-block w-inline-block">
            <div class="cr-che-ouverte-div">
              <div style="background-image:url(&quot;https://assets.website-files.com/5f7dc2c927c1329399d2b3c9/5f856e301b6f5d06979a315a_Cre%CC%80che-Illkirch-l-4.jpg&quot;)" class="cr-che-ouverte-cover"></div>
              <div class="cr-che-ouverte-text">
                <h3 class="h3-cr-che">Les anges d&#x27;Illkirch</h3>
                <p class="text-block-color">154 Route de Lyon, Illkirch</p>
                <div class="places-disponibles-cr-ches">
                  <p class="cr-che-place-dispo">3</p>
                  <p class="cr-che-place-dispo">Place(s) disponible(s)</p>
                </div>
                <p class="date">December 12, 2016</p>
                <p class="gmaplink">https://www.google.com/maps/place/Micro-Cr%C3%A8che+des+Anges+d&#x27;Illkirch/@48.5282431,7.7078054,17z/data=!3m1!4b1!4m5!3m4!1s0x4796ca11a42a2611:0xeaec77a351736b9!8m2!3d48.5282396!4d7.7099941</p>
                <p class="p-cr-che">Les anges d&#x27;Illkirch est la première micro-crèche du réseau les anges. Nous y accueillons vos enfants comme si c&#x27;était les nôtres et leurs proposons des activités ludiques.</p>
              </div>
            </div>
          </a></div>
      </div>
      <div class="w-dyn-empty" hidden>
        <div>No items found.</div>
      </div>
    </div>
    <h2 class="h2-centered margin-bottom-40">Nous avons des crèches dans tout le Bas-Rhin</h2>
    <div class="w-layout-grid grid-google-maps">
      <div class="div-map-grid">
        <div class="html-embed-3 w-embed">
          <div id="map" style="width: 100%; height: 100%;"></div>
        </div>
      </div>
      <div id="detailcreche" class="div-map-text">
        <h2 class="maps-h2">Découvrez nos crèches</h2>
        <p class="paragraph-contact">Cliquez sur la crèche de votre choix pour pouvoir découvrir ses équipements, son équipe et y inscrire votre petit ange.</p>
        <a href="creches.html" class="button-1 w-button">Toutes les crèches</a>
      </div>
    </div>
    <div class="hidden">
      <h3 class="h3-map-pin"></h3>
    </div>
  </div>
  <script type="text/javascript">
    let map;
    var detail = 'detailcreche',
    itemContainer = "itemContainer", // L'élément contenant les points à afficher
      nomName = 'h3-cr-che', // L'élément contenant le nom du point à afficher
      markerTypeName = 'h3-map-pin', // L'élément dont le marqueur doit reprendre la class
      gmaplink = "gmaplink", // La class associé à la l'élément DOM où on retrouve le lien google map du point à afficher
      zoomMax = 15, // Le zoom maximum à faire pour afficher la carte
      mapId = 'map', // L'ID de l'élément DOM où afficher la carte
      iconClassName = 'date'; // L'élément DOM où on récupère les informations pour choisir l'icon à afficher
    /** @const {RegExp} */ // Obtenir la lattitude et longitude d'un lien google map
    var mapLinkRegex = new RegExp('@(.*),(.*),');
    var icons = {
      1: 'http://maps.google.com/mapfiles/ms/icons/green-dot.png',
      0: 'http://maps.google.com/mapfiles/ms/icons/red-dot.png',
    }
    /**
     * Renvoie la latitude et longitude à partir d'un Regex appliquée à un URL
     * @param {string} mapLink - L'URL dont on extrait la latitude et la longitude
     * @param (RegExp) regex
     */
    function getLatLon(mapLink, regex = mapLinkRegex) {
      if (mapLink == "" || mapLink == null, mapLink == false) {
        return false
      } else {
        var lon_lat_match = mapLink.match(regex)
        if (lon_lat_match == null) {
          return false
        } else {
          return {
            lat: parseFloat(lon_lat_match[1]),
            lon: parseFloat(lon_lat_match[2])
          }
        }
      }
    }
    /**
     * Renvoie le nom contenu dans une classe
     * @param {string} className - La class dont on prend la balise contenant le nom
     * @param {HTML} context - Le périmètre de recherche de chaque localisation
     * @return (HTML) nom
     */
    function getNom(className, context = document) {
      var enoms = context.getElementsByClassName(className);
      if (enoms.length != 1) {
        return false
      } else {
        return enoms[0].innerHTML
      }
    }
    /**
     * @param {html} element - La balise dont le contenu est à récupérer
     */
    function createElink(element) {
      return element.innerHTML
    }
    /**
     * @param {html} context - Le périmètre de recherche de chaque localisation
     * @param {string} className - La class à appliquer à la balise
     * @param {string} nom - Le nom du marker, à afficher
     * @return {HTML} - Marker, cf : API Google Map
     */
    function createMarker(element, className, nom) {

      marker = document.createElement("a");
      h3 = document.createElement('h3');
      marker.href = element.children[0].href;
      h3.appendChild(document.createTextNode(nom));
      h3.className = className;
      h3.innerHTML = nom;
      marker.appendChild(h3);
      marker = marker.outerHTML;
      return marker
    }

    function getIcon(icons, className, context = document) {
      var icon,
        key = context.getElementsByClassName(className)[0].innerHTML.length;
      if (key != 0) {
        key = 1
      }
      return icons[key]
    }
    /**
    Renvoie la liste des localisations détenue dans une balise className
    * @param {string} className - La class où se trouve chaque localisation
    * @param {html} [context=document] - Le périmètre de recherche de chaque localisation
    * {Array<Array<>>} locations - Chaque
    * @property {number} locations.avgLat - Lattitude moyenne des locations
    * @property {number} locations.avgLon - longitude moyenne des locations
    * @property {Object} locations.bounds - Limites de la map, cf : API Google Map
    * {number} location.lat - Latitude
    * {number} location.lon - Longitude
    * {string} location.href - Lien vers la localisation
    * {Object} location.marker - Marker, cf : API Google Map
    * {HTML} location.elink - Balise HTML à afficher lorsque la localisation est sélectionnée
    * {string} location.icon - Link to a public icon to display as a marker
    * @return {Array} locations
    */
    function getLocations(className, regex = mapLinkRegex, gmaplink = gmaplink,
      markerTypeName = markerTypeName, nomName = nomName,
      icons = icons, iconClassName = iconClassName, context = document) {
      var bounds = new google.maps.LatLngBounds(),
        locations = Array(),
        i,
        elements = context.getElementById(className).children;

      for (i = 0; i < elements.length; i++) {
        var element = elements[i],
          maplink = element.getElementsByClassName(gmaplink)[0].innerHTML
        // Obtenir la lattitudes et longitudes du lien google map en suivant la regex
        var latLon = getLatLon(maplink, regex);
        if (latLon == false) {
          continue
        }
        lat = latLon['lat']
        lon = latLon['lon']
        // Obtenir le nom de la localisation
        var nom = getNom(nomName, element);
        if (nom == false) {
          continue
        }
        // Créer le marker
        var marker = createMarker(element, markerTypeName, nom),
          href = marker['href'],
          elink = createElink(element),
          icon = getIcon(icons, className = iconClassName, context = element);

        // Stocker les informations dans un objet pour itérer
        locations.push({
          lat: lat,
          lon: lon,
          marker: marker,
          elink: elink,
          href: href,
          icon: icon
        });
        bounds.extend({
          lat: lat,
          lng: lon
        });
      }
      locations.avgLat = avgArray(locations, 'lat');
      locations.avgLon = avgArray(locations, 'lon');
      locations.bounds = bounds;
      return locations
    }
    /**
     * Moyenne arithmétique d'une dimension de la matrice
     * @param {Array} array la matrice
     * @param {string} attr La dimension
     * @return {Float} La moyenne
     */
    function avgArray(array, attr) {
      if (array.length == 0) {
        return 0
      }
      var sum = array.reduce(function(prev, cur) {
        return prev + cur[attr];
      }, 0);
      return sum / array.length
    }

    function initMap() {
      var locations = getLocations(itemContainer, mapLinkRegex, gmaplink,
        markerTypeName, nomName,
        icons, iconClassName);

      var map = new google.maps.Map(document.getElementById(mapId), {
        center: new google.maps.LatLng(locations.avgLat, locations.avgLon),
        mapTypeId: google.maps.MapTypeId.ROADMAP
      });


      var infowindow = new google.maps.InfoWindow();
      var marker, i;

      for (i = 0; i < locations.length; i++) {
        marker = new google.maps.Marker({
          position: new google.maps.LatLng(locations[i].lat, locations[i].lon),
          map: map,
          icon: {
            url: locations[i].icon
          },
          title: locations[i].marker,
        });



        google.maps.event.addListener(marker, 'click', (function(marker, i) {
          return function() {
            document.getElementById(detail).innerHTML = locations[i].elink;
            infowindow.setContent(locations[i].marker);
            infowindow.open(map, marker);
          }
        })(marker, i));
      }
      // fit map
      google.maps.event.addListenerOnce(map, 'bounds_changed', function(event) {
        this.setZoom(map.getZoom() - 1);
        if (this.getZoom() > zoomMax) {
          this.setZoom(zoomMax);
        }
      });
      map.fitBounds(locations.bounds);
    }
    initMap()
  </script>
</body>

</html>
